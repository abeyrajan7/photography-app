(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[235],{2016:()=>{},6514:(e,l,i)=>{Promise.resolve().then(i.bind(i,4845))},4845:(e,l,i)=>{"use strict";i.r(l),i.d(l,{default:()=>g});var s=i(5155),o=i(2115),t=i(9757),n=i(5055),a=i(4939),r=i(5394);i(9722);var c=i(6956),d=i.n(c),u=i(2818);d().config();let h=e=>{let{closeMenu:l,fetchImages:i}=e,[t,n]=(0,o.useState)(null),[c,d]=(0,o.useState)(!1),h=async()=>{if(!t){alert("Please choose a file before uploading.");return}d(!0);let e=new a.Y({region:u.env.AWS_REGION||"ap-south-1",credentials:{accessKeyId:u.env.NEXT_PUBLIC_AWS_ACCESS_KEY_ID||"",secretAccessKey:u.env.NEXT_PUBLIC_AWS_SECRET_ACCESS_KEY||""}}),s={Bucket:"framefinder-photography-abey",Key:"photos/".concat(t.name),Body:new Uint8Array(await t.arrayBuffer()),ContentType:t.type};console.log("Upload Parameters:",s),console.log("Generated S3 URL:","https://".concat(s.Bucket,".s3.ap-south-1.amazonaws.com/").concat(s.Key)),console.log("Client_ID",e);try{let o=new r.w(s);console.log("Attempting to upload:",s),await e.send(o),alert("File uploaded successfully!"),await i(),l()}catch(e){e instanceof Error?(console.error("Error uploading file:",e.message),alert("Upload failed: ".concat(e.message))):(console.error("Unexpected error:",e),alert("Upload failed: Unknown error"))}finally{d(!1)}};return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,s.jsx)("label",{htmlFor:"file-input",style:{cursor:"pointer",color:"#007BFF",textDecoration:"underline"},children:"Choose File"}),(0,s.jsx)("input",{id:"file-input",type:"file",accept:".jpg,.png",style:{display:"none"},onChange:e=>{var l;let i=null===(l=e.target.files)||void 0===l?void 0:l[0];i&&(["image/jpeg","image/png"].includes(i.type)?n(i):(alert("Only JPG and PNG files are allowed."),e.target.value=""))}})]}),(0,s.jsx)("div",{children:t&&(0,s.jsxs)("p",{children:["Selected File: ",t.name]})}),(0,s.jsx)("button",{onClick:h,style:{marginRight:"10px"},disabled:c,children:c?"Uploading...":"Upload"}),(0,s.jsx)("button",{onClick:l,children:"Close"})]})};var p=i(2615);function m(e){let{isOpen:l,onClose:i}=e;return l?(0,s.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:(0,s.jsxs)("div",{className:"bg-white p-6 rounded-md shadow-md",children:[(0,s.jsx)("h2",{className:"text-lg font-bold mb-4",children:"Login Required"}),(0,s.jsx)("p",{className:"mb-4",children:"You need to log in with Google to like this image."}),(0,s.jsx)("button",{onClick:()=>(0,p.signIn)("google"),className:"bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600",children:"Login with Google"}),(0,s.jsx)("button",{onClick:i,className:"ml-4 bg-gray-300 px-4 py-2 rounded-md hover:bg-gray-400",children:"Cancel"})]})}):null}i(5549);var k=i(2818);function g(){let[e,l]=(0,o.useState)(!1),[i,a]=(0,o.useState)(null),[r,c]=(0,o.useState)(!1),[d,u]=(0,o.useState)([]),[g,y]=(0,o.useState)(!1),[f,x]=(0,o.useState)(!1),v="http://localhost:3001",{data:j}=(0,p.useSession)();async function E(e){var s;if(console.log("User session:",j),!j){l(!1),x(!0);return}let o=null===(s=j.user)||void 0===s?void 0:s.email;if(!o){console.error("Error: Email is not available in the session.");return}u(l=>l.map(l=>l.key===e?{...l,likes:(l.likes||0)+(l.liked?-1:1),liked:!l.liked}:l)),(null==i?void 0:i.key)===e&&a(e=>e?{...e,likes:(e.likes||0)+(e.liked?-1:1),liked:!e.liked}:null);try{let l=await fetch("http://localhost:3001/api/unlike",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:o,image_key:e})}),i=await l.json();if(console.log("API Response:",i),!i.success)throw Error("Unlike request failed")}catch(l){console.error("Error updating Unlike:",l),u(l=>l.map(l=>l.key===e?{...l,likes:(l.likes||0)-(l.liked?-1:1),liked:!l.liked}:l)),(null==i?void 0:i.key)===e&&a(e=>e?{...e,likes:(e.likes||0)-(e.liked?-1:1),liked:!e.liked}:null)}}async function N(e){var s;if(console.log("User session:",j),!j){l(!1),x(!0);return}let o=null===(s=j.user)||void 0===s?void 0:s.email;if(!o){console.error("Error: Email is not available in the session.");return}u(l=>l.map(l=>l.key===e?{...l,likes:(l.likes||0)+(l.liked?-1:1),liked:!l.liked}:l)),(null==i?void 0:i.key)===e&&a(e=>e?{...e,likes:(e.likes||0)+(e.liked?-1:1),liked:!e.liked}:null);try{let l=await fetch("http://localhost:3001/api/like",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:o,image_key:e})}),i=await l.json();if(console.log("API Response:",i),!i.success)throw Error("Like request failed")}catch(l){console.error("Error updating like:",l),u(l=>l.map(l=>l.key===e?{...l,likes:(l.likes||0)+(l.liked?-1:1),liked:!l.liked}:l)),(null==i?void 0:i.key)===e&&a(e=>e?{...e,likes:(e.likes||0)+(e.liked?-1:1),liked:!e.liked}:null)}}let C=async e=>{try{console.log("\uD83D\uDCE2 Session Data:",j),console.log("Sending ",k.env.NEXT_PUBLIC_API_URL),console.log("\uD83D\uDCE2 Extracted userEmail:",e);let l=e?"".concat(v,"/api/images?user_id=").concat(encodeURIComponent(e)):"".concat(v,"/api/images"),i=await fetch(l),s=await i.json();if(!i.ok)throw Error("HTTP error! status: ".concat(i.status));console.log(s.data[0].likes),u([...s.data]),setTimeout(()=>{console.log("âœ… State after update:",d)},1e3)}catch(e){console.error("Error fetching images:",e)}};(0,o.useEffect)(()=>{var e;C((null==j?void 0:null===(e=j.user)||void 0===e?void 0:e.email)||null)},[j]);let b=e=>{let i=new Image;i.src=e.url,i.onload=()=>{c(i.height>i.width),a(e),l(!0)}},w=async e=>{if(!e){console.error("File key is undefined. Cannot proceed with delete."),alert("No file selected for deletion.");return}let i=e.split("/").pop();try{console.log("Sending DELETE request to:",k.env.NEXT_PUBLIC_API_URL,"".concat(v,"/").concat(i));let s=await fetch("".concat(v,"/api/images/").concat(i),{method:"DELETE"});if(!s.ok)throw Error("Failed to delete image: ".concat(s.statusText));alert("Photo deleted successfully!"),u(l=>l.filter(l=>l.key!==e)),l(!1)}catch(e){console.error("Error deleting photo:",e),alert("Failed to delete photo. Please try again.")}};return(0,s.jsxs)("div",{className:"photo-gallery",children:[d.length>0?d.map((e,l)=>(0,s.jsx)("div",{className:"photo",children:(0,s.jsxs)("figure",{className:"hover-effect",children:[(0,s.jsx)("img",{src:e.url,onClick:()=>b(e),alt:"Photo ".concat(l+1)}),(0,s.jsxs)("figcaption",{className:"interactions",children:[(0,s.jsxs)("span",{children:[(0,s.jsx)(t.g,{icon:n.qcK,className:e.liked?"liked-icon":"unliked-icon"})," ",e.likes]}),(0,s.jsxs)("span",{children:[(0,s.jsx)(t.g,{icon:n.DN2})," 12"]})]})]})},l)):(0,s.jsx)("p",{children:"Loading images..."}),e&&(0,s.jsx)("div",{className:"modal-overlay",onClick:()=>{l(!1),a(null)},children:(0,s.jsxs)("div",{className:"display-modal ".concat(r?"portrait":"landscape"),onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("img",{src:null==i?void 0:i.url,alt:"Selected"}),(0,s.jsxs)("div",{className:"interaction-section ".concat(r?"portrait":"landscape"),children:[(0,s.jsx)("h2",{className:"picture-caption",children:(null==i?void 0:i.title)||" "}),(0,s.jsxs)("div",{className:"comments",children:[(0,s.jsx)("p",{className:"comments-title",children:"Comments"}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{className:"".concat(r?"comment-text":"landscape-comment-text"),children:"abeyrajan7: Great shot!"}),(0,s.jsx)("li",{className:"".concat(r?"comment-text":"landscape-comment-text"),children:"abeyrajan7: This an amazing picture."})]}),(0,s.jsxs)("ul",{className:"delete-option",children:[(0,s.jsx)("li",{onClick:()=>w((null==i?void 0:i.key)||""),children:"Delete"}),(null==i?void 0:i.liked)?(0,s.jsxs)("li",{onClick:()=>E((null==i?void 0:i.key)||""),children:["Unlike (",(null==i?void 0:i.likes)||0,")"]}):(0,s.jsxs)("li",{onClick:()=>N((null==i?void 0:i.key)||""),children:["Like (",(null==i?void 0:i.likes)||0,")"]})]})]})]})]})}),g&&(0,s.jsx)("div",{className:"modal-overlay",children:(0,s.jsx)("div",{className:"modal-content",children:(0,s.jsx)(h,{fetchImages:C,closeMenu:()=>{y(!1)}})})}),(0,s.jsx)("div",{className:"btn-parent",children:(0,s.jsx)("button",{className:"add-btn fas fa-plus",onClick:()=>{y(!0)},children:(0,s.jsx)(t.g,{icon:n.QLR})})}),(0,s.jsx)(m,{isOpen:f,onClose:()=>x(!1)})]})}},5549:()=>{}},e=>{var l=l=>e(e.s=l);e.O(0,[788,266,268,79,615,803,441,517,358],()=>l(6514)),_N_E=e.O()}]);